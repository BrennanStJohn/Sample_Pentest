Penetration Test

XYZCorp

Penetration test for xyzcorp

Brennan St. John

Table of Contents

[Table of Figures 1](#_Toc173372518)

[Executive Summary 3](#_Toc173372519)

[Atack Narrative 3](#_Toc173372520)

[Findings/Remediation 4](#_Toc173372521)

[Linux 1 – Ubuntu – 192.168.2.155 4](#_Toc173372522)

[Open Ports: 4](#_Toc173372523)

[Techniques Used/Tables: 4](#_Toc173372524)

[Remediation: 6](#_Toc173372525)

[Linux 2 – Ubuntu – 192.58.1.224 6](#_Toc173372526)

[Open Ports: 6](#_Toc173372527)

[Techniques Used/Tables: 6](#_Toc173372528)

[Remediation: 7](#_Toc173372529)

[Linux 3 - Ubuntu – 192.168.2.20 8](#_Toc173372530)

[Open Ports: 8](#_Toc173372531)

[Techniques Used/Tables: 8](#_Toc173372532)

[Remediation: 9](#_Toc173372533)

[Windows – XP – 192.168.2.202 9](#_Toc173372534)

[Open Ports: 9](#_Toc173372535)

[Techniques Used/Tables: 9](#_Toc173372536)

[Remediation: 10](#_Toc173372537)

[Windows – 10 Pro – 192.168.2.147 11](#_Toc173372538)

[Open Ports: 11](#_Toc173372539)

[Techniques Used/Tables: 11](#_Toc173372540)

[Remediation: 12](#_Toc173372541)

[Windows – Server2016 – 192.168.2.100 12](#_Toc173372542)

[Open Ports: 12](#_Toc173372543)

[Techniques Used/Tables: 13](#_Toc173372544)

[Remediation: 14](#_Toc173372545)

[Summary 14](#_Toc173372546)

# Table of Figures

[Figure 1 5](#_Toc173372505)

[Figure 2 6](#_Toc173372506)

[Figure 3 7](#_Toc173372507)

[Figure 4 7](#_Toc173372508)

[Figure 5 8](#_Toc173372509)

[Figure 6 9](#_Toc173372510)

[Figure 7 10](#_Toc173372511)

[Figure 8 10](#_Toc173372512)

[Figure 9 11](#_Toc173372513)

[Figure 10 12](#_Toc173372514)

[Figure 11 13](#_Toc173372515)

[Figure 12 13](#_Toc173372516)

[Figure 13 14](#_Toc173372517)

# Executive Summary

The primary objective of this internal penetration test was to assess the security posture of XYZCorp's network, identify vulnerabilities, and provide actionable remediation steps. The scope included several Linux and Windows systems within the 192.168.2.0/24 network, with specific emphasis on gaining access to the Domain Controller and discovering sensitive data.

**Summary of Findings:**  
The test revealed several critical vulnerabilities across different systems, including outdated software, weak passwords, and misconfigurations. Exploitation of these vulnerabilities allowed unauthorized access to sensitive systems and data. Key issues included:

- **Outdated Software:** Vulnerable versions of FTP and web services.
- **Weak Authentication Mechanisms:** Reuse of weak passwords across multiple systems.
- **Lack of Network Segmentation:** Flat network topology facilitated lateral movement.
- **Users storing passwords in plain sight.**

**Impact:**  
The exploitation of these vulnerabilities could lead to unauthorized access, data exfiltration, and potential compromise of sensitive systems, including the Domain Controller.

**Recommendations:**  
Immediate measures include updating all software to the latest versions, enforcing strong password policies, and implementing network segmentation to limit lateral movement. Detailed remediation steps are provided for each identified issue.

# Atack Narrative

The penetration test began with enumeration and scanning of the network, identifying several key systems including Linux servers and a Windows Domain Controller. Key exploits and techniques used included:

1. **Linux 1 (192.168.2.155):**  
    A vulnerability in the vsftpd service (CVE-2011-2523) was exploited to gain root access. From there, SSH keys were discovered, allowing access to Linux 3 from this machine.

**CVSS Score:** 10.0 (Critical)

1. **Linux 2 (192.58.1.224):**  
    Command injection vulnerabilities in the web application running on Apache allowed us to gain root access.

**CVSS Score:** 9.0 (Critical)

1. **Linux 3 (192.168.2.20):**  
    Using SSH keys obtained from Linux 1, we accessed Linux 3. A local privilege escalation was performed using a vulnerable C program, giving us root access.

**CVSS Score:** 8.0 (High)

1. **Windows XP (192.168.2.202):**  
    Exploited using the MS08-067 vulnerability (CVE-2008-4250) to gain administrative access. Weak passwords were discovered and reused across other systems.

**CVSS Score:** 9.3 (Critical)

1. **Windows 10 Pro (192.168.2.147):**  
    Access was gained using credentials discovered on the Windows XP machine. We bypassed antivirus software to execute a payload and escalated privileges.

**CVSS Score:** 8.5 (High)

1. **Windows Server 2016 (192.168.2.100):**  
    Using credentials and a PowerShell script discovered on the Windows 10 system, administrative access was achieved. Sensitive data, including Domain Administrator credentials, was accessed.

**CVSS Score:** 10.0 (Critical)

# Findings/Remediation

## Linux 1 – Ubuntu – 192.168.2.155

### Open Ports

21/tcp open ftp vsftpd 2.3.4

22/tcp open ssh OpenSSH 6.6.1p1

### Techniques Used/Tables

Using Metasploit I was able to get access as root through the vsftpd 2.3.4 since there is a backdoor for that version. I upgraded my shell to get a better foothold and was able to see a few files, such as linux3_rsa. I found an entry in the bash history about using the linux3_rsa to ssh into another device at 192.168.2.20 which is part of our scope. I was able to move onto that machine as user “DSU” and confirmed that I was on the 192.168.2.20 network.

[!images/fig1.png](https://github.com/BrennanStJohn/Sample_Pentest/blob/db6aad8dc36110b34e61712f08bd99e32e5e91fc/images/Fig1.png)

Figure 1

![alt text](<Documents/Pentest Files/images/Fig2.png>)

Figure 2

### Remediation

Update vsftpd to the latest version and review all access control and monitoring policies.

## Linux 2 – Ubuntu – 192.58.1.224

### Open Ports

80/tcp open http Apache httpd 2.4.7

### Techniques Used/Tables

Knowing that this one is running on port 80 and running Apache, I immediately checked the website in my browser and discovered that I can perform command injection. I created a reverse shell from the command injection and made myself root in the process.

![alt text](<Pentest Files/images/Fig3.png>)

Figure 3

![alt text](<Pentest Files/images/Fig4.png>)

Figure 4

### Remediation

Implement input validation, sanitize user inputs, and regularly update web server software.

## Linux 3 - Ubuntu – 192.168.2.20

### Open Ports

22/tcp open ssh ver. 6.6.1p1

### Techniques Used/Tables

Using the machine at 192.168.2.155, I was able to get access via ssh on port 22 as user “DSU” from the RSA key being readily available on the other machine. Here I was able to read a file, named “runme.c,” which gave me a root shell by responding “y” to the prompt. Navigating around this machine I found a file, named “read-this.txt,” which has the cleartext password of “BearsBeatsBattlestarGalacitca1!” inside of it. This was useful in getting into the Windows XP machine with its NetBIOS and FQDN having SCHRUTEFARMSBNB references.

![alt text](<../Documents/Pentest Files/images/Fig5.png>)

Figure 5

![alt text](<../Documents/Pentest Files/images/Fig6.png>)

Figure 6

### Remediation

Enforce strict SSH key management policies and remove unnecessary or outdated user accounts and files.

## Windows – XP – 192.168.2.202

### Open Ports

135/tcp open msrpc

139/tcp open netbios-ssn

445/tcp open microsoft-ds Windows XP

### Techniques Used/Tables

Since we found out that this machine is running Windows XP, I was able to get into this one with relative ease using Metasploit. First, I performed a hash dump to see if I could get any additional information and found the password for the Administrator account on the system, which was Password4$ and is an extremely weak password.

![alt text](<../Documents/Pentest Files/images/Fig7.png>)

Figure 7

![alt text](<../Documents/Pentest Files/images/Fig8.png>)

Figure 8

### Remediation

Upgrade to a supported version of Windows, enforce strong password policies, and disable unused services.

## Windows – 10 Pro – 192.168.2.147

### Open Ports

135/tcp open msrpc

139/tcp open netbios-ssn

445/tcp open microsoft-ds port Windows 10 ver. 10240 (Workgroup: LAB)

### Techniques Used/Tables

Using the Hydra to brute force with some of the passwords that I found on the other machines, I was able to see that the combination of administrator and Password4$ worked together. This was reused from the Windows XP machine. I used this to get into the SMB share and upload my own payload, bypass the Antivirus and execute the payload through crackmapexec. Now that I was in the system I could navigate as I pleased after escalating my privileges and I seed that the user “mike” has made a nifty PowerShell script to make his password “ThreatLevelMidnight!” somewhat obfuscated and then run on a scheduled task to change on the Server 2016.

![alt text](<../Documents/Pentest Files/images/Fig9.png>)

Figure 9

![alt text](<../Documents/Pentest Files/images/Fig10.png>)

Figure 10

### Remediation

Implement multifactor authentication, improve endpoint protection, and regularly update software. Train users to not store passwords on their desktops.

## Windows – Server2016 – 192.168.2.100

### Open Ports

88/tcp open kerberos-sec port

135/tcp open msrpc

139/tcp open netbios-ssn

389/tcp open ldap (workgroup: LAB)

445/tcp open microsoft-ds Windows Server 2016 ver. 14393

464/tcp kasspwd5?

593/tcp open ncacn_http

636/tcp open tcpwrapped

3268/tcp open ldap (Domain: lab.local)

3269/tcp open tcpwrapped

### Techniques Used/Tables

Using the PowerShell script that mike is using to change his password on the Server, I was able to modify it and add myself as an administrator with ease. Once I logged into the SMB share with my new credentials I could navigate around as I please and repeat my payload upload to get a better shell. I see mike has some more passwords on his desktop that coincide with everything else that I have found as well. The flag on the administrator’s desktop was acquired.

![alt text](<../Documents/Pentest Files/images/Fig11.png>)

Figure 11

![alt text](<../Documents/Pentest Files/images/Fig12.png>)

Figure 12

![alt text](<../Documents/Pentest Files/images/Fig13.png>)

Figure 13

### Remediation

Enforce strong, unique passwords, regularly review and update security configurations, and ensure all software and systems are up to date. Train users to not store passwords on their desktops.

# Summary

The penetration test identified several critical security vulnerabilities that, if exploited, could lead to significant data breaches and unauthorized system access. Immediate actions are required to address these issues, including updating vulnerable systems, enforcing strong authentication mechanisms, and implementing proper network segmentation. Ongoing security awareness training and regular security assessments are recommended to maintain a robust security posture.
